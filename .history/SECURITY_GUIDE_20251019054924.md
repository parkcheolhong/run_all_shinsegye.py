# 🔐 소리새 AI 보안 시스템 가이드

## 🎯 개요

소리새 AI는 API 키와 액세스 토큰 기반의 다층 보안 시스템을 제공합니다.

## 🔑 인증 방법

### 1. API 키 (추천)

- **Master Key**: 모든 기능 접근 가능
- **Admin Key**: 관리자 기능 (대시보드, 명령, 설정, 로그)
- **User Key**: 사용자 기능 (대시보드, 명령)
- **Guest Key**: 읽기 전용 (대시보드만)

### 2. 액세스 토큰

- **Admin Token**: 관리자 기능
- **User Token**: 사용자 기능
- **Readonly Token**: 읽기 전용

## 🛠️ 키 관리 도구 사용법

### 새 API 키 생성

```bash
python security_key_manager.py add-key --name myuser --type user
```

### 새 토큰 생성

```bash
python security_key_manager.py add-token --name mytoken --type admin
```

### 키/토큰 목록 확인

```bash
python security_key_manager.py list
```

### 키/토큰 폐기

```bash
python security_key_manager.py revoke --name myuser_key
```

### 인증 정보 검증

```bash
python security_key_manager.py verify --credential "your_key_here"
```

## 🌐 웹 대시보드 사용법

### 1. 인증 없이 접근 (제한적)

- 브라우저에서 `http://localhost:5000` 접속
- 기본 정보만 확인 가능

### 2. URL 파라미터로 인증

```text
http://localhost:5000?api_key=your_api_key_here
또는
http://localhost:5000?token=your_token_here
```

### 3. 대시보드 내 인증

1. 우측 상단 "🔑 인증" 버튼 클릭
2. API 키 또는 토큰 입력
3. "✅ 인증" 버튼 클릭

## 🔧 API 사용법

### 헤더 인증

```bash
# API 키 사용
curl -H "X-API-Key: your_api_key" http://localhost:5000/api/stats

# 토큰 사용
curl -H "Authorization: your_token" http://localhost:5000/api/stats
```

### 인증 확인

```bash
curl -H "X-API-Key: your_key" http://localhost:5000/api/auth/verify
```

## 🛡️ 보안 설정

### security_config.json 구조

```json
{
  "security": {
    "api_keys": {
      "master_key": "sorisay_master_2025_secure_key_abcd1234",
      "admin_key": "sorisay_admin_202501_key_xyz789",
      "user_key": "sorisay_user_202501_key_def456",
      "guest_key": "sorisay_guest_202501_key_ghi123"
    },
    "access_tokens": {
      "admin_token": "ADM_tok_2025_mnopqrstuvwxyzabcdef",
      "user_token": "USR_tok_2025_123456789abcdefghij",
      "readonly_token": "RO_tok_2025_klmnopqrstuvwxyz1234"
    },
    "permissions": {
      "master_key": ["all"],
      "admin_key": ["dashboard", "commands", "config", "logs"],
      "user_key": ["dashboard", "commands"],
      "guest_key": ["dashboard"],
      "admin_token": ["dashboard", "commands", "logs"],
      "user_token": ["dashboard", "commands"],
      "readonly_token": ["dashboard"]
    },
    "cors": {
      "origins": ["http://localhost:5000"],
      "methods": ["GET", "POST"]
    },
    "rate_limiting": {
      "requests_per_minute": 60,
      "burst_limit": 10
    },
    "network": {
      "bind_to_localhost": true,
      "port": 5000
    },
    "allowed_commands": [
      "리팩터링", "동기화", "상태", "테스트", "정리", "도움말"
    ],
    "max_failed_attempts": 5
  }
}
```

## 🧪 보안 테스트

### 종합 테스트 실행
```bash
python security_test_suite.py
```

### 개별 기능 테스트
```bash
# 대시보드 실행
python modules/sorisay_dashboard_web.py

# 다른 터미널에서 테스트
python security_test_suite.py
```

## 🚨 보안 권장사항

### 1. 키 관리
- 마스터 키는 절대 공유하지 마세요
- 정기적으로 키를 교체하세요
- 사용하지 않는 키는 즉시 폐기하세요

### 2. 네트워크 보안
- 프로덕션에서는 HTTPS 사용 필수
- 방화벽으로 접근 제한
- VPN 또는 인증된 네트워크에서만 접근

### 3. 모니터링
- 실패한 인증 시도 모니터링
- 비정상적인 API 호출 패턴 감지
- 로그 정기 검토

## 🔒 권한 레벨별 기능

| 권한 | 대시보드 | 명령 실행 | 설정 접근 | 로그 조회 |
|------|----------|-----------|-----------|-----------|
| **all** | ✅ | ✅ | ✅ | ✅ |
| **dashboard** | ✅ | ❌ | ❌ | ❌ |
| **commands** | ✅ | ✅ | ❌ | ❌ |
| **config** | ✅ | ✅ | ✅ | ❌ |
| **logs** | ✅ | ✅ | ❌ | ✅ |

## 🆘 문제 해결

### 인증 실패
1. 키/토큰이 올바른지 확인
2. 권한이 충분한지 확인
3. 네트워크 연결 상태 확인

### 키 분실
1. `security_key_manager.py list` 로 확인
2. 새 키 생성 후 기존 키 폐기
3. 설정 파일 백업 확인

### 보안 설정 초기화
```bash
# 설정 파일 백업
cp config/security_config.json config/security_config.json.backup

# 새 설정 생성
python security_key_manager.py add-key --name admin --type admin
```

## 📞 지원

문제가 발생하면 다음을 확인해주세요:
1. 로그 파일 (`logs/` 폴더)
2. 보안 설정 파일 (`config/security_config.json`)
3. 테스트 결과 (`python security_test_suite.py`)

---
*소리새 AI 보안 시스템 v1.0*